# ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒç­–ç•¥

## ç›®å½•
- [ç‰ˆæœ¬ç®¡ç†æ¦‚è¿°](#ç‰ˆæœ¬ç®¡ç†æ¦‚è¿°)
- [è¯­ä¹‰åŒ–ç‰ˆæœ¬](#è¯­ä¹‰åŒ–ç‰ˆæœ¬)
- [åˆ†æ”¯ç­–ç•¥](#åˆ†æ”¯ç­–ç•¥)
- [å‘å¸ƒæµç¨‹](#å‘å¸ƒæµç¨‹)
- [å›æ»šç­–ç•¥](#å›æ»šç­–ç•¥)
- [å˜æ›´æ—¥å¿—](#å˜æ›´æ—¥å¿—)
- [å®æˆ˜æ¡ˆä¾‹](#å®æˆ˜æ¡ˆä¾‹)

---

## ç‰ˆæœ¬ç®¡ç†æ¦‚è¿°

### ç‰ˆæœ¬å·è§„èŒƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è¯­ä¹‰åŒ–ç‰ˆæœ¬ (SemVer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚         MAJOR . MINOR . PATCH - PRERELEASE + BUILD  â”‚
â”‚           â†“       â†“       â†“         â†“          â†“    â”‚
â”‚           1   .   2   .   3    -  alpha.1  + 001    â”‚
â”‚                                                      â”‚
â”‚  MAJOR: ä¸å…¼å®¹çš„APIå˜æ›´                              â”‚
â”‚  MINOR: å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢                           â”‚
â”‚  PATCH: å‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤                           â”‚
â”‚  PRERELEASE: é¢„å‘å¸ƒç‰ˆæœ¬                              â”‚
â”‚  BUILD: æ„å»ºå…ƒæ•°æ®                                   â”‚
â”‚                                                      â”‚
â”‚  ç¤ºä¾‹:                                               â”‚
â”‚    1.0.0         - é¦–ä¸ªæ­£å¼ç‰ˆæœ¬                      â”‚
â”‚    1.1.0         - æ–°å¢åŠŸèƒ½                          â”‚
â”‚    1.1.1         - ä¿®å¤Bug                           â”‚
â”‚    2.0.0         - ç ´åæ€§å˜æ›´                        â”‚
â”‚    2.0.0-beta.1  - Betaæµ‹è¯•ç‰ˆ                        â”‚
â”‚    2.0.0-rc.1    - Release Candidate                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç‰ˆæœ¬å‘å¸ƒç”Ÿå‘½å‘¨æœŸ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  Alpha (Î±)                                     â”‚
â”‚   â”œâ”€ å†…éƒ¨æµ‹è¯•ç‰ˆæœ¬                              â”‚
â”‚   â”œâ”€ åŠŸèƒ½ä¸å®Œæ•´                                â”‚
â”‚   â””â”€ å¯èƒ½æœ‰ä¸¥é‡Bug                             â”‚
â”‚       â”‚                                        â”‚
â”‚       â–¼                                        â”‚
â”‚  Beta (Î²)                                      â”‚
â”‚   â”œâ”€ åŠŸèƒ½åŸºæœ¬å®Œæ•´                              â”‚
â”‚   â”œâ”€ å…¬å¼€æµ‹è¯•                                  â”‚
â”‚   â””â”€ å¯èƒ½æœ‰å·²çŸ¥é—®é¢˜                            â”‚
â”‚       â”‚                                        â”‚
â”‚       â–¼                                        â”‚
â”‚  RC (Release Candidate)                        â”‚
â”‚   â”œâ”€ åŠŸèƒ½å†»ç»“                                  â”‚
â”‚   â”œâ”€ ä»…ä¿®å¤ä¸¥é‡Bug                             â”‚
â”‚   â””â”€ æœ€ç»ˆæµ‹è¯•                                  â”‚
â”‚       â”‚                                        â”‚
â”‚       â–¼                                        â”‚
â”‚  GA (General Availability)                     â”‚
â”‚   â”œâ”€ æ­£å¼å‘å¸ƒ                                  â”‚
â”‚   â”œâ”€ ç”Ÿäº§å¯ç”¨                                  â”‚
â”‚   â””â”€ å®Œæ•´æ–‡æ¡£                                  â”‚
â”‚       â”‚                                        â”‚
â”‚       â–¼                                        â”‚
â”‚  LTS (Long Term Support)                       â”‚
â”‚   â”œâ”€ é•¿æœŸæ”¯æŒ                                  â”‚
â”‚   â”œâ”€ ä»…å®‰å…¨æ›´æ–°                                â”‚
â”‚   â””â”€ ç¨³å®šç»´æŠ¤                                  â”‚
â”‚       â”‚                                        â”‚
â”‚       â–¼                                        â”‚
â”‚  EOL (End of Life)                             â”‚
â”‚   â””â”€ åœæ­¢æ”¯æŒ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¯­ä¹‰åŒ–ç‰ˆæœ¬

### è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†

```bash
# version-bump.sh
#!/bin/bash

set -euo pipefail

# å½“å‰ç‰ˆæœ¬
CURRENT_VERSION=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
CURRENT_VERSION=${CURRENT_VERSION#v}

IFS='.' read -r -a VERSION_PARTS <<< "$CURRENT_VERSION"
MAJOR=${VERSION_PARTS[0]}
MINOR=${VERSION_PARTS[1]}
PATCH=${VERSION_PARTS[2]}

# æ ¹æ®æäº¤ä¿¡æ¯ç¡®å®šç‰ˆæœ¬ç±»å‹
BUMP_TYPE=${1:-auto}

if [ "$BUMP_TYPE" = "auto" ]; then
  # åˆ†æ git log
  LOGS=$(git log --pretty=format:"%s" "${CURRENT_VERSION}..HEAD")

  if echo "$LOGS" | grep -qE "^BREAKING CHANGE:|^feat!:|^fix!:"; then
    BUMP_TYPE="major"
  elif echo "$LOGS" | grep -qE "^feat:"; then
    BUMP_TYPE="minor"
  else
    BUMP_TYPE="patch"
  fi
fi

# è®¡ç®—æ–°ç‰ˆæœ¬
case $BUMP_TYPE in
  major)
    MAJOR=$((MAJOR + 1))
    MINOR=0
    PATCH=0
    ;;
  minor)
    MINOR=$((MINOR + 1))
    PATCH=0
    ;;
  patch)
    PATCH=$((PATCH + 1))
    ;;
  *)
    echo "Unknown bump type: $BUMP_TYPE"
    exit 1
    ;;
esac

NEW_VERSION="${MAJOR}.${MINOR}.${PATCH}"
echo "ğŸ“¦ Bumping version from ${CURRENT_VERSION} to ${NEW_VERSION}"

# æ›´æ–°ç‰ˆæœ¬æ–‡ä»¶
echo "${NEW_VERSION}" > VERSION
git add VERSION

# åˆ›å»º Git tag
git tag -a "v${NEW_VERSION}" -m "Release v${NEW_VERSION}"

echo "âœ… Version bumped to v${NEW_VERSION}"
```

### Conventional Commits

```bash
# æäº¤ä¿¡æ¯è§„èŒƒ
# <type>(<scope>): <subject>
#
# type: feat, fix, docs, style, refactor, test, chore, perf
# scope: å½±å“èŒƒå›´
# subject: ç®€çŸ­æè¿°

# ç¤ºä¾‹
git commit -m "feat(api): add user authentication endpoint"
git commit -m "fix(database): resolve connection pool leak"
git commit -m "docs: update API documentation"
git commit -m "chore(deps): upgrade dependencies"

# ç ´åæ€§å˜æ›´
git commit -m "feat(api)!: change authentication flow

BREAKING CHANGE: OAuth2 is now required for all endpoints"
```

---

## åˆ†æ”¯ç­–ç•¥

### Git Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Git Flow åˆ†æ”¯æ¨¡å‹                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  main (ç”Ÿäº§åˆ†æ”¯)                               â”‚
â”‚   â”‚                                            â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ v1.0.0         â”‚
â”‚   â”‚                           â”‚                â”‚
â”‚   â”‚                           â”‚                â”‚
â”‚  develop (å¼€å‘åˆ†æ”¯)           â”‚                â”‚
â”‚   â”‚                           â”‚                â”‚
â”‚   â”œâ”€ feature/login â”€â”€â”        â”‚                â”‚
â”‚   â”‚                  â”‚        â”‚                â”‚
â”‚   â”œâ”€ feature/paymentâ”€â”¤        â”‚                â”‚
â”‚   â”‚                  â”‚        â”‚                â”‚
â”‚   â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                â”‚
â”‚   â”‚                           â”‚                â”‚
â”‚   â”œâ”€ release/1.0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
â”‚   â”‚      â”‚                    â”‚                â”‚
â”‚   â—€â”€â”€â”€â”€â”€â”€â”¤ (bug fixes)        â”‚                â”‚
â”‚          â”‚                    â”‚                â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
â”‚                                â”‚                â”‚
â”‚  hotfix/critical-bug â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚   â”‚                           â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GitHub Flow (ç®€åŒ–ç‰ˆ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GitHub Flow åˆ†æ”¯æ¨¡å‹                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  main (ä¸»åˆ†æ”¯)                                 â”‚
â”‚   â”‚                                            â”‚
â”‚   â”œâ”€ feature-1 â”€â”                             â”‚
â”‚   â”‚              â”‚                             â”‚
â”‚   â”‚              â”œâ”€ PR â”€â–¶ Merge               â”‚
â”‚   â”‚              â”‚                             â”‚
â”‚   â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚   â”‚                                            â”‚
â”‚   â”œâ”€ feature-2 â”€â”                             â”‚
â”‚   â”‚              â”‚                             â”‚
â”‚   â”‚              â”œâ”€ PR â”€â–¶ Merge               â”‚
â”‚   â”‚              â”‚                             â”‚
â”‚   â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚   â”‚                                            â”‚
â”‚   â””â”€ æ¯æ¬¡åˆå¹¶è‡ªåŠ¨éƒ¨ç½²                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Trunk-Based Development

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Trunk-Based Development                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  main (ä¸»å¹²)                                   â”‚
â”‚   â”‚                                            â”‚
â”‚   â”œâ”€ çŸ­æœŸåˆ†æ”¯ (1-2å¤©) â”€â”                      â”‚
â”‚   â”‚                     â”‚                      â”‚
â”‚   â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚   â”‚                                            â”‚
â”‚   â”œâ”€ çŸ­æœŸåˆ†æ”¯ â”€â”                              â”‚
â”‚   â”‚            â”‚                               â”‚
â”‚   â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚   â”‚                                            â”‚
â”‚   â””â”€ ç‰¹æ€§å¼€å…³æ§åˆ¶åŠŸèƒ½å‘å¸ƒ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‘å¸ƒæµç¨‹

### å®Œæ•´å‘å¸ƒ Workflow

```yaml
# .github/workflows/release.yml
name: Release

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to release (e.g., 1.2.3)'
        required: true

jobs:
  prepare:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      changelog: ${{ steps.changelog.outputs.changelog }}

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Determine version
        id: version
        run: |
          if [ -n "${{ github.event.inputs.version }}" ]; then
            VERSION="${{ github.event.inputs.version }}"
          else
            # è‡ªåŠ¨è®¡ç®—ç‰ˆæœ¬
            CURRENT=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")
            CURRENT=${CURRENT#v}

            # åŸºäºæäº¤åˆ¤æ–­ç‰ˆæœ¬ç±»å‹
            if git log ${CURRENT}..HEAD --pretty=format:"%s" | grep -qE "^BREAKING CHANGE:|^feat!:|^fix!:"; then
              BUMP="major"
            elif git log ${CURRENT}..HEAD --pretty=format:"%s" | grep -qE "^feat:"; then
              BUMP="minor"
            else
              BUMP="patch"
            fi

            # è®¡ç®—æ–°ç‰ˆæœ¬
            IFS='.' read -r -a parts <<< "$CURRENT"
            case $BUMP in
              major) VERSION="$((parts[0]+1)).0.0" ;;
              minor) VERSION="${parts[0]}.$((parts[1]+1)).0" ;;
              patch) VERSION="${parts[0]}.${parts[1]}.$((parts[2]+1))" ;;
            esac
          fi

          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "ğŸ“¦ Version: ${VERSION}"

      - name: Generate changelog
        id: changelog
        run: |
          CURRENT=$(git describe --tags --abbrev=0 2>/dev/null || echo "")

          if [ -n "$CURRENT" ]; then
            CHANGELOG=$(git log ${CURRENT}..HEAD --pretty=format:"- %s (%h)" --no-merges)
          else
            CHANGELOG=$(git log --pretty=format:"- %s (%h)" --no-merges)
          fi

          # åˆ†ç±»æäº¤
          FEATURES=$(echo "$CHANGELOG" | grep "^- feat:" || echo "")
          FIXES=$(echo "$CHANGELOG" | grep "^- fix:" || echo "")
          OTHERS=$(echo "$CHANGELOG" | grep -v "^- feat:" | grep -v "^- fix:" || echo "")

          FORMATTED_CHANGELOG="## What's Changed

### Features
$FEATURES

### Bug Fixes
$FIXES

### Other Changes
$OTHERS
"
          echo "changelog<<EOF" >> $GITHUB_OUTPUT
          echo "$FORMATTED_CHANGELOG" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

  build:
    needs: prepare
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Build and push
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            ghcr.io/${{ github.repository }}:${{ needs.prepare.outputs.version }}
            ghcr.io/${{ github.repository }}:latest
          cache-from: type=gha
          cache-to: type=gha,mode=max

  test:
    needs: build
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run integration tests
        run: |
          docker-compose -f docker-compose.test.yml up -d
          docker-compose -f docker-compose.test.yml run tests
          docker-compose -f docker-compose.test.yml down

  deploy-staging:
    needs: test
    runs-on: ubuntu-latest
    environment:
      name: staging
      url: https://staging.example.com

    steps:
      - name: Deploy to staging
        run: |
          kubectl set image deployment/myapp \
            myapp=ghcr.io/${{ github.repository }}:${{ needs.prepare.outputs.version }} \
            -n staging

  release:
    needs: [prepare, deploy-staging]
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Create Git tag
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git tag -a v${{ needs.prepare.outputs.version }} \
            -m "Release v${{ needs.prepare.outputs.version }}"
          git push origin v${{ needs.prepare.outputs.version }}

      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v${{ needs.prepare.outputs.version }}
          release_name: Release v${{ needs.prepare.outputs.version }}
          body: ${{ needs.prepare.outputs.changelog }}
          draft: false
          prerelease: false

  deploy-production:
    needs: release
    runs-on: ubuntu-latest
    environment:
      name: production
      url: https://example.com

    steps:
      - name: Deploy to production
        run: |
          kubectl set image deployment/myapp \
            myapp=ghcr.io/${{ github.repository }}:${{ needs.prepare.outputs.version }} \
            -n production
```

---

## å›æ»šç­–ç•¥

### å¿«é€Ÿå›æ»šè„šæœ¬

```bash
#!/bin/bash
# rollback.sh

set -euo pipefail

NAMESPACE=${1:-production}
DEPLOYMENT=${2:-myapp}

echo "ğŸ”™ Starting rollback for ${DEPLOYMENT} in ${NAMESPACE}"

# 1. æŸ¥çœ‹å†å²ç‰ˆæœ¬
echo "ğŸ“œ Deployment history:"
kubectl rollout history deployment/${DEPLOYMENT} -n ${NAMESPACE}

# 2. è·å–å½“å‰ç‰ˆæœ¬
CURRENT_REVISION=$(kubectl get deployment ${DEPLOYMENT} -n ${NAMESPACE} \
  -o jsonpath='{.metadata.annotations.deployment\.kubernetes\.io/revision}')

echo "Current revision: ${CURRENT_REVISION}"

# 3. ç¡®è®¤å›æ»š
read -p "Rollback to previous revision? (yes/no): " confirm
if [ "$confirm" != "yes" ]; then
  echo "âŒ Rollback cancelled"
  exit 0
fi

# 4. æ‰§è¡Œå›æ»š
echo "âª Rolling back..."
kubectl rollout undo deployment/${DEPLOYMENT} -n ${NAMESPACE}

# 5. ç­‰å¾…å›æ»šå®Œæˆ
echo "â³ Waiting for rollback to complete..."
kubectl rollout status deployment/${DEPLOYMENT} -n ${NAMESPACE} --timeout=300s

# 6. éªŒè¯å›æ»š
NEW_REVISION=$(kubectl get deployment ${DEPLOYMENT} -n ${NAMESPACE} \
  -o jsonpath='{.metadata.annotations.deployment\.kubernetes\.io/revision}')

READY_REPLICAS=$(kubectl get deployment ${DEPLOYMENT} -n ${NAMESPACE} \
  -o jsonpath='{.status.readyReplicas}')

echo "âœ… Rollback completed"
echo "   Previous revision: ${CURRENT_REVISION}"
echo "   Current revision: ${NEW_REVISION}"
echo "   Ready replicas: ${READY_REPLICAS}"

# 7. å‘é€é€šçŸ¥
curl -X POST 'https://hooks.slack.com/services/xxx' \
  -H 'Content-Type: application/json' \
  -d "{
    \"text\": \"ğŸ”™ Rollback completed for ${DEPLOYMENT} in ${NAMESPACE}\\nRevision: ${CURRENT_REVISION} â†’ ${NEW_REVISION}\"
  }"
```

### æ•°æ®åº“å›æ»šç­–ç•¥

```sql
-- migration-rollback.sql
-- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§

BEGIN;

-- 1. å¤‡ä»½å½“å‰æ•°æ®
CREATE TABLE users_backup_20260207 AS
SELECT * FROM users;

-- 2. æ‰§è¡Œå›æ»š
ALTER TABLE users DROP COLUMN new_feature_column;

-- 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
DO $$
DECLARE
  user_count INTEGER;
BEGIN
  SELECT COUNT(*) INTO user_count FROM users;

  IF user_count < 1000 THEN
    RAISE EXCEPTION 'Data integrity check failed: too few users';
  END IF;
END $$;

-- 4. æäº¤äº‹åŠ¡
COMMIT;

-- å¦‚æœå¤±è´¥ä¼šè‡ªåŠ¨å›æ»š
```

---

## å˜æ›´æ—¥å¿—

### è‡ªåŠ¨ç”Ÿæˆ CHANGELOG

```bash
#!/bin/bash
# generate-changelog.sh

set -euo pipefail

CURRENT_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "")
OUTPUT_FILE="CHANGELOG.md"

# ç”Ÿæˆ CHANGELOG
{
  echo "# Changelog"
  echo ""
  echo "All notable changes to this project will be documented in this file."
  echo ""

  # éå†æ‰€æœ‰æ ‡ç­¾
  TAGS=$(git tag --sort=-version:refname)

  PREV_TAG=""
  for TAG in $TAGS; do
    echo "## [${TAG}] - $(git log -1 --format=%ai ${TAG} | cut -d' ' -f1)"
    echo ""

    # ç¡®å®šèŒƒå›´
    if [ -z "$PREV_TAG" ]; then
      RANGE="${TAG}"
    else
      RANGE="${TAG}..${PREV_TAG}"
    fi

    # åˆ†ç±»æäº¤
    echo "### Features"
    git log ${RANGE} --pretty=format:"- %s ([%h](https://github.com/myorg/myrepo/commit/%H))" \
      --grep="^feat" --no-merges || echo ""
    echo ""

    echo "### Bug Fixes"
    git log ${RANGE} --pretty=format:"- %s ([%h](https://github.com/myorg/myrepo/commit/%H))" \
      --grep="^fix" --no-merges || echo ""
    echo ""

    echo "### Documentation"
    git log ${RANGE} --pretty=format:"- %s ([%h](https://github.com/myorg/myrepo/commit/%H))" \
      --grep="^docs" --no-merges || echo ""
    echo ""

    PREV_TAG=$TAG
  done
} > ${OUTPUT_FILE}

echo "âœ… Changelog generated: ${OUTPUT_FILE}"
```

### CHANGELOG æ¨¡æ¿

```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- New feature X
- Support for Y

### Changed
- Improved performance of Z

### Deprecated
- Feature A will be removed in v2.0.0

### Removed
- Unused configuration option B

### Fixed
- Bug in component C
- Security vulnerability in dependency D

### Security
- Fixed CVE-2024-XXXXX

## [1.2.0] - 2026-02-07

### Added
- User authentication with OAuth2
- Rate limiting for API endpoints

### Fixed
- Memory leak in background worker
- Race condition in cache invalidation

## [1.1.0] - 2026-01-15

### Added
- Email notification system
- Export to CSV feature

### Changed
- Updated UI design
- Improved database query performance

## [1.0.0] - 2026-01-01

### Added
- Initial release
- Core features implemented
```

---

## å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹: å¤§è§„æ¨¡æœåŠ¡å‘å¸ƒæµç¨‹

```yaml
# release-workflow.yaml
# å®Œæ•´çš„ç”Ÿäº§å‘å¸ƒæµç¨‹

stages:
  # 1. å‡†å¤‡é˜¶æ®µ
  prepare:
    - version_bump
    - changelog_generation
    - dependency_audit
    - security_scan

  # 2. æ„å»ºé˜¶æ®µ
  build:
    - compile_code
    - run_unit_tests
    - build_containers
    - push_to_registry

  # 3. æµ‹è¯•é˜¶æ®µ
  test:
    - integration_tests
    - e2e_tests
    - performance_tests
    - security_tests

  # 4. é¢„å‘å¸ƒ
  pre_release:
    - deploy_to_staging
    - smoke_tests
    - manual_verification

  # 5. å‘å¸ƒ
  release:
    - create_release_tag
    - generate_release_notes
    - publish_artifacts

  # 6. éƒ¨ç½²
  deploy:
    - canary_deployment:
        percentage: 10
        duration: 30m
    - expand_deployment:
        percentage: 50
        duration: 1h
    - full_deployment:
        percentage: 100

  # 7. éªŒè¯
  verify:
    - health_checks
    - metric_validation
    - error_rate_check

  # 8. æ¸…ç†
  cleanup:
    - remove_old_versions
    - cleanup_artifacts
    - update_documentation
```

---

## æ€»ç»“

### ç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç‰ˆæœ¬ç®¡ç†åå¤§æœ€ä½³å®è·µ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ 1. ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ (SemVer)                    â”‚
â”‚ 2. è‡ªåŠ¨åŒ–ç‰ˆæœ¬å·ç”Ÿæˆ                            â”‚
â”‚ 3. ä¿æŒè¯¦ç»†çš„å˜æ›´æ—¥å¿—                          â”‚
â”‚ 4. ä½¿ç”¨ Git æ ‡ç­¾æ ‡è®°ç‰ˆæœ¬                       â”‚
â”‚ 5. å®æ–½ä»£ç å®¡æŸ¥æµç¨‹                            â”‚
â”‚ 6. è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–                              â”‚
â”‚ 7. åˆ†é˜¶æ®µå‘å¸ƒ(é‡‘ä¸é›€/è“ç»¿)                     â”‚
â”‚ 8. å‡†å¤‡å›æ»šé¢„æ¡ˆ                                â”‚
â”‚ 9. ç›‘æ§å‘å¸ƒæŒ‡æ ‡                                â”‚
â”‚ 10. æ–‡æ¡£åŒ–å‘å¸ƒæµç¨‹                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æ‰«ææ— é«˜å±æ¼æ´
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] å˜æ›´æ—¥å¿—å·²ç”Ÿæˆ
- [ ] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡
- [ ] ç›‘æ§å‘Šè­¦å·²é…ç½®
- [ ] ç›¸å…³å›¢é˜Ÿå·²é€šçŸ¥
- [ ] å‘å¸ƒæ—¶é—´çª—å£å·²ç¡®è®¤

### ä¸‹ä¸€æ­¥å­¦ä¹ 
- [../API_Gateway/01_gateway_design.md](../API_Gateway/01_gateway_design.md) - APIç½‘å…³è®¾è®¡
