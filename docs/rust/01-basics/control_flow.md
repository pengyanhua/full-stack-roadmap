# control flow.rs

::: info æ–‡ä»¶ä¿¡æ¯
- ğŸ“„ åŸæ–‡ä»¶ï¼š`02_control_flow.rs`
- ğŸ”¤ è¯­è¨€ï¼šrust
:::

## å®Œæ•´ä»£ç 

```rust
// ============================================================
//                      æµç¨‹æ§åˆ¶
// ============================================================
// Rust çš„æµç¨‹æ§åˆ¶ä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œä½†æœ‰å‡ ä¸ªç‹¬ç‰¹ä¹‹å¤„ï¼š
// 1. if æ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿”å›å€¼
// 2. loop æ˜¯æ— é™å¾ªç¯ï¼Œä¹Ÿæ˜¯è¡¨è¾¾å¼
// 3. æ¨¡å¼åŒ¹é…ï¼ˆmatchï¼‰éå¸¸å¼ºå¤§
// 4. æ¡ä»¶ä¸éœ€è¦æ‹¬å·

fn main() {
    println!("=== æµç¨‹æ§åˆ¶ ===");

    // ----------------------------------------------------------
    // 1. if è¡¨è¾¾å¼
    // ----------------------------------------------------------
    // ã€é‡è¦ã€‘if çš„æ¡ä»¶ä¸éœ€è¦æ‹¬å·ï¼ˆä¸ C/Java ä¸åŒï¼‰
    // ã€é‡è¦ã€‘æ¡ä»¶å¿…é¡»æ˜¯ bool ç±»å‹ï¼ˆä¸èƒ½ç”¨æ•°å­—ä»£æ›¿ï¼‰
    // ã€ç‰¹æ€§ã€‘if æ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥æœ‰è¿”å›å€¼

    let number = 7;

    if number > 5 {
        println!("{} å¤§äº 5", number);
    } else if number > 0 {
        println!("{} åœ¨ 1-5 ä¹‹é—´", number);
    } else {
        println!("{} å°äºç­‰äº 0", number);
    }

    // ã€æŠ€å·§ã€‘if ä½œä¸ºè¡¨è¾¾å¼èµ‹å€¼ï¼ˆç±»ä¼¼ä¸‰å…ƒè¿ç®—ç¬¦ï¼‰
    // Rust æ²¡æœ‰ä¸‰å…ƒè¿ç®—ç¬¦ ?:ï¼Œç”¨ if è¡¨è¾¾å¼ä»£æ›¿
    let condition = true;
    let value = if condition { 5 } else { 10 };
    println!("if è¡¨è¾¾å¼: value = {}", value);

    // ã€æ³¨æ„ã€‘ä¸¤ä¸ªåˆ†æ”¯çš„è¿”å›ç±»å‹å¿…é¡»ä¸€è‡´
    // let bad = if condition { 5 } else { "hello" };  // é”™è¯¯ï¼ç±»å‹ä¸åŒ

    // ----------------------------------------------------------
    // 2. loop æ— é™å¾ªç¯
    // ----------------------------------------------------------
    // loop åˆ›å»ºæ— é™å¾ªç¯ï¼Œå¿…é¡»ç”¨ break é€€å‡º
    // ã€ç‰¹æ€§ã€‘loop æ˜¯è¡¨è¾¾å¼ï¼Œbreak å¯ä»¥è¿”å›å€¼
    // ã€ä¸ while true çš„åŒºåˆ«ã€‘loop æ›´æ˜ç¡®è¡¨ç¤º"æˆ‘çŸ¥é“è¿™æ˜¯æ— é™å¾ªç¯"

    let mut counter = 0;
    let result = loop {
        counter += 1;
        if counter == 10 {
            break counter * 2;  // break è¿”å›å€¼
        }
    };
    println!("loop è¿”å›å€¼: {}", result); // 20

    // ã€æŠ€å·§ã€‘å¾ªç¯æ ‡ç­¾ï¼ˆå¤„ç†åµŒå¥—å¾ªç¯ï¼‰
    // ä½¿ç”¨ 'label å‘½åå¾ªç¯ï¼Œbreak/continue å¯ä»¥æŒ‡å®šè·³å‡ºå“ªå±‚
    let mut count = 0;
    'outer: loop {
        let mut remaining = 10;
        loop {
            if remaining == 9 {
                break;  // åªé€€å‡ºå†…å±‚å¾ªç¯
            }
            if count == 2 {
                break 'outer;  // é€€å‡ºå¤–å±‚å¾ªç¯
            }
            remaining -= 1;
        }
        count += 1;
    }
    println!("åµŒå¥—å¾ªç¯: count = {}", count);

    // ----------------------------------------------------------
    // 3. while æ¡ä»¶å¾ªç¯
    // ----------------------------------------------------------
    let mut n = 5;
    while n > 0 {
        print!("{} ", n);
        n -= 1;
    }
    println!("å‘å°„ï¼");

    // ----------------------------------------------------------
    // 4. for å¾ªç¯ï¼ˆæœ€å¸¸ç”¨ï¼‰
    // ----------------------------------------------------------
    // for éå†è¿­ä»£å™¨ï¼Œæ˜¯ Rust ä¸­æœ€å¸¸ç”¨çš„å¾ªç¯
    // ã€ä¼˜åŠ¿ã€‘å®‰å…¨ã€ç®€æ´ã€ä¸ä¼šè¶Šç•Œ

    // éå†æ•°ç»„
    let fruits = ["è‹¹æœ", "é¦™è•‰", "æ©™å­", "è‘¡è„"];
    for fruit in fruits.iter() {
        print!("{} ", fruit);
    }
    println!();

    // éå†èŒƒå›´ï¼ˆRangeï¼‰
    // ã€è¯­æ³•ã€‘start..endï¼ˆä¸åŒ…å« endï¼‰æˆ– start..=endï¼ˆåŒ…å« endï¼‰
    print!("1åˆ°5: ");
    for i in 1..=5 {
        print!("{} ", i);
    }
    println!();

    // åå‘éå†
    print!("å€’æ•°: ");
    for i in (1..=5).rev() {
        print!("{} ", i);
    }
    println!();

    // å¸¦ç´¢å¼•éå†
    for (index, value) in fruits.iter().enumerate() {
        println!("  [{}] {}", index, value);
    }

    // ã€æŠ€å·§ã€‘ç”¨ for ä»£æ›¿ while éå†
    // å·®: while i < arr.len() { arr[i]; i += 1; }  // æ¯æ¬¡è®¿é—®æœ‰è¾¹ç•Œæ£€æŸ¥
    // å¥½: for item in &arr { ... }                   // æ²¡æœ‰è¾¹ç•Œæ£€æŸ¥ï¼Œæ›´å¿«

    // ----------------------------------------------------------
    // 5. match æ¨¡å¼åŒ¹é…
    // ----------------------------------------------------------
    // match æ˜¯ Rust æœ€å¼ºå¤§çš„æ§åˆ¶æµå·¥å…·
    // ã€é‡è¦ã€‘match å¿…é¡»ç©·å°½æ‰€æœ‰å¯èƒ½æ€§ï¼ˆexhaustiveï¼‰
    // ã€ç±»æ¯”ã€‘ç±»ä¼¼ switchï¼Œä½†åŠŸèƒ½å¼ºå¤§å¾—å¤š

    let number = 3;
    match number {
        1 => println!("ä¸€"),
        2 => println!("äºŒ"),
        3 => println!("ä¸‰"),
        4 | 5 => println!("å››æˆ–äº”"),         // å¤šä¸ªå€¼ç”¨ | åˆ†éš”
        6..=10 => println!("å…­åˆ°å"),        // èŒƒå›´åŒ¹é…
        _ => println!("å…¶ä»–"),              // _ æ˜¯é€šé…ç¬¦ï¼ŒåŒ¹é…æ‰€æœ‰å‰©ä½™
    }

    // match ä¹Ÿæ˜¯è¡¨è¾¾å¼
    let text = match number {
        1 => "one",
        2 => "two",
        3 => "three",
        _ => "other",
    };
    println!("match è¡¨è¾¾å¼: {}", text);

    // åŒ¹é…å…ƒç»„
    let point = (0, -2);
    match point {
        (0, 0) => println!("åŸç‚¹"),
        (x, 0) => println!("x è½´ä¸Š, x={}", x),
        (0, y) => println!("y è½´ä¸Š, y={}", y),
        (x, y) => println!("ç‚¹ ({}, {})", x, y),
    }

    // å¸¦æ¡ä»¶çš„åŒ¹é…ï¼ˆmatch guardï¼‰
    let num = Some(4);
    match num {
        Some(x) if x < 5 => println!("å°äº 5 çš„å€¼: {}", x),
        Some(x) => println!("å€¼: {}", x),
        None => println!("æ²¡æœ‰å€¼"),
    }

    // ----------------------------------------------------------
    // 6. if let ç®€æ´åŒ¹é…
    // ----------------------------------------------------------
    // å½“åªå…³å¿ƒä¸€ç§æ¨¡å¼æ—¶ï¼Œç”¨ if let æ¯” match æ›´ç®€æ´
    // ã€é€‚ç”¨åœºæ™¯ã€‘åªéœ€å¤„ç† Some/Ok ç­‰å•ä¸€æƒ…å†µ

    let some_value: Option<i32> = Some(42);

    // ç”¨ matchï¼ˆç•¥ç¹çï¼‰
    match some_value {
        Some(val) => println!("match: {}", val),
        None => {},
    }

    // ç”¨ if letï¼ˆæ›´ç®€æ´ï¼‰
    if let Some(val) = some_value {
        println!("if let: {}", val);
    }

    // if let ä¹Ÿå¯ä»¥æœ‰ else
    let no_value: Option<i32> = None;
    if let Some(val) = no_value {
        println!("æœ‰å€¼: {}", val);
    } else {
        println!("if let else: æ²¡æœ‰å€¼");
    }

    // ----------------------------------------------------------
    // 7. while let æ¡ä»¶å¾ªç¯æ¨¡å¼åŒ¹é…
    // ----------------------------------------------------------
    // ä¸ if let ç±»ä¼¼ï¼Œåœ¨æ¨¡å¼åŒ¹é…æˆåŠŸæ—¶æŒç»­å¾ªç¯

    let mut stack = vec![1, 2, 3];
    print!("while let å¼¹å‡º: ");
    while let Some(top) = stack.pop() {
        print!("{} ", top);
    }
    println!();

    // ----------------------------------------------------------
    // 8. let-elseï¼ˆRust 1.65+ï¼‰
    // ----------------------------------------------------------
    // å½“æ¨¡å¼åŒ¹é…å¤±è´¥æ—¶æ‰§è¡Œ else åˆ†æ”¯ï¼ˆå¿…é¡»å‘æ•£ï¼šreturn, break, panic ç­‰ï¼‰
    // ã€ç”¨é€”ã€‘å‡å°‘åµŒå¥—ï¼Œæå‰é€€å‡º

    let config_value: Option<&str> = Some("42");

    // ç”¨ let-else ç®€åŒ–
    let Some(val) = config_value else {
        println!("é…ç½®å€¼ç¼ºå¤±");
        return;
    };
    println!("let-else: é…ç½®å€¼ = {}", val);

    println!("\n=== æµç¨‹æ§åˆ¶ç»“æŸ ===");
}
```
