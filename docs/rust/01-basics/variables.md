# variables.rs

::: info æ–‡ä»¶ä¿¡æ¯
- ğŸ“„ åŸæ–‡ä»¶ï¼š`01_variables.rs`
- ğŸ”¤ è¯­è¨€ï¼šrust
:::

## å®Œæ•´ä»£ç 

```rust
// ============================================================
//                      å˜é‡ä¸æ•°æ®ç±»å‹
// ============================================================
// Rust æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å¤§éƒ¨åˆ†ç±»å‹
// Rust çš„å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œè¿™æ˜¯ Rust å®‰å…¨æ€§çš„åŸºçŸ³
// ä½¿ç”¨ mut å…³é”®å­—ä½¿å˜é‡å¯å˜

fn main() {
    println!("=== å˜é‡å£°æ˜ ===");

    // ----------------------------------------------------------
    // 1. ä¸å¯å˜å˜é‡ï¼ˆé»˜è®¤ï¼‰
    // ----------------------------------------------------------
    // ä½¿ç”¨ let å£°æ˜å˜é‡ï¼Œé»˜è®¤ä¸å¯å˜
    // ã€é‡è¦ã€‘Rust é»˜è®¤ä¸å¯å˜æ˜¯æœ‰æ„ä¸ºä¹‹ï¼Œé¼“åŠ±å†™å‡ºæ›´å®‰å…¨çš„ä»£ç 

    let x = 5;
    println!("ä¸å¯å˜å˜é‡ x = {}", x);
    // x = 6;  // é”™è¯¯ï¼ä¸å¯å˜å˜é‡ä¸èƒ½é‡æ–°èµ‹å€¼

    // ----------------------------------------------------------
    // 2. å¯å˜å˜é‡ï¼ˆmutï¼‰
    // ----------------------------------------------------------
    // ä½¿ç”¨ mut å…³é”®å­—å£°æ˜å¯å˜å˜é‡
    // ã€å»ºè®®ã€‘åªæœ‰ç¡®å®éœ€è¦ä¿®æ”¹æ—¶æ‰ç”¨ mutï¼Œå‡å°‘ mut ä½¿ç”¨æ˜¯å¥½ä¹ æƒ¯

    let mut y = 10;
    println!("å¯å˜å˜é‡ y = {}", y);
    y = 20;
    println!("ä¿®æ”¹å y = {}", y);

    // ----------------------------------------------------------
    // 3. å˜é‡é®è”½ï¼ˆShadowingï¼‰
    // ----------------------------------------------------------
    // å¯ä»¥ç”¨ let é‡æ–°å£°æ˜åŒåå˜é‡ï¼Œè¿™å«é®è”½ï¼ˆshadowingï¼‰
    // ã€ä¸ mut çš„åŒºåˆ«ã€‘é®è”½åˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„å˜é‡ï¼Œå¯ä»¥æ”¹å˜ç±»å‹
    // ã€é€‚ç”¨åœºæ™¯ã€‘ç±»å‹è½¬æ¢æ—¶éå¸¸æœ‰ç”¨ï¼Œé¿å…èµ· name_strã€name_len è¿™æ ·çš„åå­—

    let z = 5;
    let z = z + 1;       // é®è”½ï¼šz ä» 5 å˜æˆ 6
    let z = z * 2;       // å†æ¬¡é®è”½ï¼šz ä» 6 å˜æˆ 12
    println!("é®è”½å z = {}", z);

    // é®è”½å¯ä»¥æ”¹å˜ç±»å‹ï¼ˆmut åšä¸åˆ°ï¼‰
    let spaces = "   ";           // &str ç±»å‹
    let spaces = spaces.len();    // usize ç±»å‹ï¼ŒåŒåä½†ä¸åŒç±»å‹
    println!("spaces é•¿åº¦ = {}", spaces);

    // å¦‚æœç”¨ mut å°±ä¸è¡Œï¼š
    // let mut spaces = "   ";
    // spaces = spaces.len();  // é”™è¯¯ï¼ç±»å‹ä¸åŒ¹é…

    // ----------------------------------------------------------
    // 4. å¸¸é‡ï¼ˆconstï¼‰
    // ----------------------------------------------------------
    // ä½¿ç”¨ const å£°æ˜ï¼Œå¿…é¡»æ ‡æ³¨ç±»å‹ï¼Œå€¼å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡
    // ã€å‘½åè§„èŒƒã€‘å…¨å¤§å†™ + ä¸‹åˆ’çº¿ï¼ˆSCREAMING_SNAKE_CASEï¼‰
    // ã€ä¸ let çš„åŒºåˆ«ã€‘
    //   - const å¿…é¡»æ ‡æ³¨ç±»å‹
    //   - const ä¸èƒ½ç”¨ mut
    //   - const å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡è¡¨è¾¾å¼
    //   - const å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€

    const MAX_POINTS: u32 = 100_000;
    const PI: f64 = 3.141_592_653_589_793;
    println!("å¸¸é‡ MAX_POINTS = {}", MAX_POINTS);
    println!("å¸¸é‡ PI = {}", PI);

    // ã€æŠ€å·§ã€‘æ•°å­—å­—é¢é‡å¯ä»¥ç”¨ä¸‹åˆ’çº¿åˆ†éš”å¢åŠ å¯è¯»æ€§
    let big_number = 1_000_000;
    println!("å¤§æ•°å­— = {}", big_number);

    // ============================================================
    //                      åŸºæœ¬æ•°æ®ç±»å‹
    // ============================================================
    println!("\n=== åŸºæœ¬æ•°æ®ç±»å‹ ===");

    // ----------------------------------------------------------
    // æ•´æ•°ç±»å‹
    // ----------------------------------------------------------
    // æœ‰ç¬¦å·: i8, i16, i32, i64, i128, isize
    // æ— ç¬¦å·: u8, u16, u32, u64, u128, usize
    //
    // isize/usize: å–å†³äºå¹³å°ï¼Œ64ä½ç³»ç»Ÿå°±æ˜¯64ä½
    // ã€é»˜è®¤ã€‘æ•´æ•°å­—é¢é‡é»˜è®¤æ˜¯ i32
    // ã€å»ºè®®ã€‘ä¸€èˆ¬ç”¨ i32ï¼Œç´¢å¼•ç”¨ usize

    let a: i8 = 127;              // -128 åˆ° 127
    let b: i16 = 32_767;          // -32768 åˆ° 32767
    let c: i32 = 2_147_483_647;   // çº¦ 21 äº¿ï¼ˆé»˜è®¤æ•´æ•°ç±»å‹ï¼‰
    let d: i64 = 9_223_372_036_854_775_807;
    let e: i128 = 170_141_183_460_469_231_731_687_303_715_884_105_727;

    println!("i8={}, i16={}, i32={}", a, b, c);
    println!("i64={}", d);
    println!("i128={}", e);

    let u: u8 = 255;
    let v: usize = 42;  // å¹³å°ç›¸å…³ï¼Œå¸¸ç”¨äºç´¢å¼•
    println!("u8={}, usize={}", u, v);

    // ã€æŠ€å·§ã€‘æ•´æ•°å­—é¢é‡çš„å¤šç§å†™æ³•
    let decimal = 98_222;       // åè¿›åˆ¶
    let hex = 0xff;             // åå…­è¿›åˆ¶
    let octal = 0o77;           // å…«è¿›åˆ¶
    let binary = 0b1111_0000;   // äºŒè¿›åˆ¶
    let byte_val = b'A';        // å­—èŠ‚ï¼ˆä»… u8ï¼‰
    println!("åè¿›åˆ¶={}, åå…­è¿›åˆ¶={}, å…«è¿›åˆ¶={}, äºŒè¿›åˆ¶={}, å­—èŠ‚={}",
             decimal, hex, octal, binary, byte_val);

    // ã€è­¦å‘Šã€‘æ•´æ•°æº¢å‡º
    // Debug æ¨¡å¼ä¸‹ä¼š panicï¼ŒRelease æ¨¡å¼ä¸‹ä¼šå›ç»•ï¼ˆwrappingï¼‰
    // å¦‚æœéœ€è¦æ˜ç¡®çš„æº¢å‡ºè¡Œä¸ºï¼Œä½¿ç”¨ wrapping_*ã€checked_*ã€overflowing_*ã€saturating_* æ–¹æ³•
    let max_u8: u8 = 255;
    println!("u8 wrapping_add: {}", max_u8.wrapping_add(1));     // 0
    println!("u8 saturating_add: {}", max_u8.saturating_add(1)); // 255
    println!("u8 checked_add: {:?}", max_u8.checked_add(1));     // None

    // ----------------------------------------------------------
    // æµ®ç‚¹ç±»å‹
    // ----------------------------------------------------------
    // f32: å•ç²¾åº¦ï¼Œçº¦ 6-7 ä½æœ‰æ•ˆæ•°å­—
    // f64: åŒç²¾åº¦ï¼Œçº¦ 15 ä½æœ‰æ•ˆæ•°å­—
    //
    // ã€é»˜è®¤ã€‘æµ®ç‚¹å­—é¢é‡é»˜è®¤æ˜¯ f64
    // ã€å»ºè®®ã€‘é»˜è®¤ä½¿ç”¨ f64ï¼Œåœ¨ç°ä»£ CPU ä¸Šé€Ÿåº¦ä¸ f32 ç›¸å½“

    let f1: f32 = 3.14;
    let f2: f64 = 3.141_592_653_589_793;
    println!("f32={:.7}, f64={:.15}", f1, f2);

    // ã€è­¦å‘Šã€‘æµ®ç‚¹ç²¾åº¦é—®é¢˜
    println!("0.1 + 0.2 = {:.20}ï¼ˆä¸ç­‰äº 0.3ï¼‰", 0.1_f64 + 0.2_f64);

    // ----------------------------------------------------------
    // å¸ƒå°”ç±»å‹
    // ----------------------------------------------------------
    // åªæœ‰ true å’Œ falseï¼Œå  1 å­—èŠ‚
    // ã€æ³¨æ„ã€‘ä¸èƒ½ç”¨æ•°å­—ä»£æ›¿å¸ƒå°”å€¼ï¼ˆä¸åƒ C/C++ï¼‰

    let is_active: bool = true;
    let is_deleted = false;  // ç±»å‹æ¨æ–­
    println!("is_active={}, is_deleted={}", is_active, is_deleted);

    // ----------------------------------------------------------
    // å­—ç¬¦ç±»å‹ï¼ˆcharï¼‰
    // ----------------------------------------------------------
    // 4 å­—èŠ‚å¤§å°ï¼Œè¡¨ç¤ºä¸€ä¸ª Unicode æ ‡é‡å€¼
    // ä½¿ç”¨å•å¼•å· '' è¡¨ç¤º
    // ã€é‡è¦ã€‘char ä¸æ˜¯ 1 å­—èŠ‚ï¼Œæ˜¯ 4 å­—èŠ‚ï¼ˆä¸ C/C++ ä¸åŒï¼‰
    // èŒƒå›´ï¼šU+0000 åˆ° U+D7FF å’Œ U+E000 åˆ° U+10FFFF

    let c1 = 'z';
    let c2 = 'ä¸­';
    let c3 = 'ğŸ¦€';  // Rust çš„å‰ç¥¥ç‰©èƒèŸ¹
    println!("å­—ç¬¦: {} {} {}", c1, c2, c3);
    println!("char å¤§å° = {} å­—èŠ‚", std::mem::size_of::<char>());

    // ============================================================
    //                      å¤åˆç±»å‹
    // ============================================================
    println!("\n=== å¤åˆç±»å‹ ===");

    // ----------------------------------------------------------
    // å…ƒç»„ï¼ˆTupleï¼‰
    // ----------------------------------------------------------
    // å›ºå®šé•¿åº¦ï¼Œå…ƒç´ ç±»å‹å¯ä»¥ä¸åŒ
    // ã€ç”¨é€”ã€‘ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼ã€ä¸´æ—¶åˆ†ç»„æ•°æ®

    let tup: (i32, f64, bool) = (500, 6.4, true);

    // è§£æ„å…ƒç»„
    let (tx, ty, tz) = tup;
    println!("è§£æ„: x={}, y={}, z={}", tx, ty, tz);

    // ç´¢å¼•è®¿é—®ï¼ˆä» 0 å¼€å§‹ï¼Œä½¿ç”¨ç‚¹å·ï¼‰
    println!("ç´¢å¼•è®¿é—®: {}, {}, {}", tup.0, tup.1, tup.2);

    // å•å…ƒå…ƒç»„ï¼ˆunit typeï¼‰ï¼š() è¡¨ç¤ºç©ºå€¼/æ— è¿”å›å€¼
    let _unit: () = ();

    // ----------------------------------------------------------
    // æ•°ç»„ï¼ˆArrayï¼‰
    // ----------------------------------------------------------
    // å›ºå®šé•¿åº¦ï¼Œæ‰€æœ‰å…ƒç´ ç±»å‹ç›¸åŒï¼Œå­˜å‚¨åœ¨æ ˆä¸Š
    // ã€ä¸ Vec çš„åŒºåˆ«ã€‘æ•°ç»„é•¿åº¦å›ºå®šï¼ŒVec å¯å˜
    // ã€é€‚ç”¨åœºæ™¯ã€‘å·²çŸ¥å…ƒç´ æ•°é‡ä¸”ä¸ä¼šå˜åŒ–æ—¶ä½¿ç”¨æ•°ç»„

    let arr = [1, 2, 3, 4, 5];
    println!("æ•°ç»„: {:?}", arr);
    println!("ç¬¬ä¸€ä¸ªå…ƒç´ : {}", arr[0]);
    println!("æ•°ç»„é•¿åº¦: {}", arr.len());

    // å£°æ˜ç±»å‹å’Œé•¿åº¦
    let arr2: [i32; 5] = [1, 2, 3, 4, 5];
    println!("æ˜¾å¼ç±»å‹æ•°ç»„: {:?}", arr2);

    // ç”¨ç›¸åŒå€¼å¡«å……
    let arr3 = [0; 10];  // åˆ›å»ºé•¿åº¦ä¸º 10ã€å…¨éƒ¨ä¸º 0 çš„æ•°ç»„
    println!("å¡«å……æ•°ç»„: {:?}", arr3);

    // ã€å®‰å…¨ã€‘æ•°ç»„è¶Šç•Œä¼šåœ¨è¿è¡Œæ—¶ panicï¼ˆä¸åƒ C/C++ çš„æœªå®šä¹‰è¡Œä¸ºï¼‰
    // let bad = arr[10];  // ç¼–è¯‘é€šè¿‡ä½†è¿è¡Œæ—¶ panic: index out of bounds

    // ----------------------------------------------------------
    // å­—ç¬¦ä¸²ï¼ˆString å’Œ &strï¼‰
    // ----------------------------------------------------------
    // &str: å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œä¸å¯å˜å¼•ç”¨ï¼Œé€šå¸¸æ˜¯å­—é¢é‡
    // String: å †ä¸Šåˆ†é…ï¼Œå¯å¢é•¿çš„å­—ç¬¦ä¸²
    // ã€é‡è¦åŒºåˆ«ã€‘
    //   - &str æ˜¯å€Ÿç”¨ï¼ŒString æ˜¯æ‹¥æœ‰
    //   - å­—é¢é‡ "hello" æ˜¯ &str ç±»å‹
    //   - String å¯ä»¥ä¿®æ”¹ï¼Œ&str ä¸èƒ½

    let s1: &str = "ä½ å¥½ï¼Œä¸–ç•Œ";          // å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼ˆå­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼‰
    let s2: String = String::from("ä½ å¥½"); // å †ä¸Šåˆ†é…çš„ String
    let s3: String = "ä¸–ç•Œ".to_string();  // å¦ä¸€ç§åˆ›å»º String çš„æ–¹å¼

    println!("&str: {}", s1);
    println!("String: {} {}", s2, s3);

    // String å¯ä»¥æ‹¼æ¥
    let mut s4 = String::from("Hello");
    s4.push(' ');           // è¿½åŠ å­—ç¬¦
    s4.push_str("Rust!");   // è¿½åŠ å­—ç¬¦ä¸²
    println!("æ‹¼æ¥: {}", s4);

    // ã€æŠ€å·§ã€‘format! å®æ‹¼æ¥ï¼ˆä¸ä¼šè·å–æ‰€æœ‰æƒï¼‰
    let greeting = format!("{}, {}!", s2, s3);
    println!("format!: {}", greeting);

    // ã€æ³¨æ„ã€‘Rust å­—ç¬¦ä¸²æ˜¯ UTF-8 ç¼–ç 
    // ä¸èƒ½ç›´æ¥ç”¨ç´¢å¼•è®¿é—®ï¼ˆå› ä¸ºå­—ç¬¦å¯èƒ½æ˜¯å¤šå­—èŠ‚çš„ï¼‰
    // s1[0]  // é”™è¯¯ï¼
    // æ­£ç¡®çš„éå†æ–¹å¼ï¼š
    print!("éå†å­—ç¬¦: ");
    for ch in "Rustè¯­è¨€".chars() {
        print!("{} ", ch);
    }
    println!();

    print!("éå†å­—èŠ‚: ");
    for byte in "Rust".bytes() {
        print!("{} ", byte);
    }
    println!();

    // ============================================================
    //                      ç±»å‹è½¬æ¢
    // ============================================================
    println!("\n=== ç±»å‹è½¬æ¢ ===");

    // Rust æ²¡æœ‰éšå¼ç±»å‹è½¬æ¢ï¼Œå¿…é¡»ä½¿ç”¨ as å…³é”®å­—æ˜¾å¼è½¬æ¢
    // ã€æ³¨æ„ã€‘as è½¬æ¢å¯èƒ½ä¼šæˆªæ–­æˆ–ä¸¢å¤±ç²¾åº¦

    let integer: i32 = 42;
    let float: f64 = integer as f64;
    println!("i32 -> f64: {} -> {}", integer, float);

    let float2: f64 = 3.99;
    let integer2: i32 = float2 as i32;  // æˆªæ–­ï¼Œä¸æ˜¯å››èˆäº”å…¥
    println!("f64 -> i32: {} -> {}ï¼ˆæˆªæ–­ï¼‰", float2, integer2);

    let big: i32 = 256;
    let small: u8 = big as u8;  // æº¢å‡ºæˆªæ–­
    println!("i32 -> u8: {} -> {}ï¼ˆæº¢å‡ºæˆªæ–­ï¼‰", big, small);

    // å­—ç¬¦ä¸æ•°å­—è½¬æ¢
    let ch = 'A';
    let code = ch as u32;
    println!("char -> u32: '{}' -> {}", ch, code);

    // ã€æ¨èã€‘æ›´å®‰å…¨çš„è½¬æ¢æ–¹å¼
    // - TryFrom/TryInto: å¯èƒ½å¤±è´¥çš„è½¬æ¢ï¼Œè¿”å› Result
    // - From/Into: ä¸€å®šæˆåŠŸçš„è½¬æ¢
    let num: i32 = 42;
    let big_num: i64 = i64::from(num);  // i32 -> i64 ä¸€å®šæˆåŠŸ
    println!("From è½¬æ¢: {} -> {}", num, big_num);

    // TryInto å¯èƒ½å¤±è´¥
    use std::convert::TryInto;
    let big_val: i64 = 1_000;
    let result: Result<i32, _> = big_val.try_into();
    println!("TryInto è½¬æ¢: {} -> {:?}", big_val, result);

    // ============================================================
    //                      ç±»å‹åˆ«å
    // ============================================================
    println!("\n=== ç±»å‹åˆ«å ===");

    // ä½¿ç”¨ type å…³é”®å­—åˆ›å»ºç±»å‹åˆ«å
    // ã€ç”¨é€”ã€‘ç®€åŒ–å¤æ‚ç±»å‹ã€å¢åŠ å¯è¯»æ€§

    type Meters = f64;
    type Seconds = f64;

    let distance: Meters = 100.0;
    let time: Seconds = 9.58;
    let speed = distance / time;
    println!("é€Ÿåº¦ = {:.2} ç±³/ç§’", speed);

    // ã€æ³¨æ„ã€‘ç±»å‹åˆ«åä¸åˆ›å»ºæ–°ç±»å‹ï¼Œåªæ˜¯å¦ä¸€ä¸ªåå­—
    // Meters å’Œ f64 å®Œå…¨ç­‰ä»·ï¼Œå¯ä»¥äº’ç›¸èµ‹å€¼
    // å¦‚æœéœ€è¦çœŸæ­£çš„æ–°ç±»å‹ï¼Œä½¿ç”¨æ–°ç±»å‹æ¨¡å¼ï¼ˆNewtype Patternï¼‰:
    // struct Meters(f64);
}
```
