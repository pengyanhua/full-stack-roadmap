# pointers.c

::: info æ–‡ä»¶ä¿¡æ¯
- ğŸ“„ åŸæ–‡ä»¶ï¼š`01_pointers.c`
- ğŸ”¤ è¯­è¨€ï¼šc
:::

## å®Œæ•´ä»£ç 

```c
// ============================================================
//                      æŒ‡é’ˆï¼ˆPointersï¼‰
// ============================================================
// æŒ‡é’ˆæ˜¯ C è¯­è¨€çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå­˜å‚¨å†…å­˜åœ°å€
// ç†è§£æŒ‡é’ˆæ˜¯æŒæ¡ C è¯­è¨€çš„å…³é”®
// & å–åœ°å€è¿ç®—ç¬¦ï¼Œ* è§£å¼•ç”¨è¿ç®—ç¬¦

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(void) {
    printf("=== æŒ‡é’ˆåŸºç¡€ ===\n");

    // ----------------------------------------------------------
    // 1. æŒ‡é’ˆå£°æ˜ä¸åŸºæœ¬æ“ä½œ
    // ----------------------------------------------------------
    int x = 42;
    int *p = &x;  // p æ˜¯æŒ‡å‘ int çš„æŒ‡é’ˆï¼Œå­˜å‚¨ x çš„åœ°å€

    printf("x çš„å€¼:    %d\n", x);
    printf("x çš„åœ°å€:  %p\n", (void*)&x);
    printf("p çš„å€¼:    %pï¼ˆå­˜å‚¨ x çš„åœ°å€ï¼‰\n", (void*)p);
    printf("*pï¼ˆè§£å¼•ç”¨ï¼‰: %dï¼ˆx çš„å€¼ï¼‰\n", *p);

    // é€šè¿‡æŒ‡é’ˆä¿®æ”¹å€¼
    *p = 100;
    printf("ä¿®æ”¹å x = %d\n", x);  // x å˜æˆ 100

    // NULL æŒ‡é’ˆï¼ˆä¸æŒ‡å‘ä»»ä½•æœ‰æ•ˆåœ°å€ï¼‰
    int *null_p = NULL;
    printf("NULL æŒ‡é’ˆ: %p\n", (void*)null_p);
    // ã€å±é™©ã€‘ä¸è¦è§£å¼•ç”¨ NULL æŒ‡é’ˆï¼š*null_p  -> æ®µé”™è¯¯ï¼

    // ----------------------------------------------------------
    // 2. æŒ‡é’ˆä¸æ•°ç»„
    // ----------------------------------------------------------
    printf("\n=== æŒ‡é’ˆä¸æ•°ç»„ ===\n");

    int arr[] = {10, 20, 30, 40, 50};
    int *pa = arr;  // æ•°ç»„åå³é¦–å…ƒç´ åœ°å€

    printf("arr[0]   = %d\n", arr[0]);
    printf("*pa      = %d\n", *pa);       // ç­‰ä»·äº arr[0]
    printf("*(pa+1)  = %d\n", *(pa+1));   // ç­‰ä»·äº arr[1]
    printf("*(pa+2)  = %d\n", *(pa+2));   // ç­‰ä»·äº arr[2]

    // æŒ‡é’ˆç®—æœ¯ï¼ˆpointer arithmeticï¼‰
    // æŒ‡é’ˆåŠ å‡çš„å•ä½æ˜¯å…ƒç´ å¤§å°ï¼Œä¸æ˜¯å­—èŠ‚
    printf("\næŒ‡é’ˆç®—æœ¯:\n");
    for (int i = 0; i < 5; i++) {
        printf("  arr+%d = %p, å€¼ = %d\n", i, (void*)(arr+i), *(arr+i));
    }

    // æ•°ç»„ä¸‹æ ‡ç­‰ä»·äºæŒ‡é’ˆè¿ç®—
    for (int i = 0; i < 5; i++) {
        // arr[i] ç­‰ä»·äº *(arr + i)
        printf("  arr[%d]=%d, *(arr+%d)=%d\n", i, arr[i], i, *(arr+i));
    }

    // æŒ‡é’ˆå‡æ³•ï¼ˆå¾—åˆ°ä¸¤æŒ‡é’ˆé—´çš„å…ƒç´ æ•°ï¼‰
    int *first = arr;
    int *last = arr + 4;
    printf("last - first = %tdï¼ˆå…ƒç´ æ•°ï¼‰\n", last - first);

    // ----------------------------------------------------------
    // 3. æŒ‡é’ˆçš„æŒ‡é’ˆï¼ˆäºŒçº§æŒ‡é’ˆï¼‰
    // ----------------------------------------------------------
    printf("\n=== äºŒçº§æŒ‡é’ˆ ===\n");

    int val = 999;
    int *ptr = &val;
    int **pptr = &ptr;  // æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ

    printf("val    = %d\n", val);
    printf("*ptr   = %d\n", *ptr);
    printf("**pptr = %d\n", **pptr);  // è§£å¼•ç”¨ä¸¤æ¬¡

    **pptr = 777;
    printf("ä¿®æ”¹å val = %d\n", val);

    // åº”ç”¨ï¼šå‡½æ•°ä¿®æ”¹æŒ‡é’ˆæœ¬èº«
    // void alloc(int **out) { *out = malloc(sizeof(int)); }

    // ----------------------------------------------------------
    // 4. æŒ‡é’ˆä¸ const
    // ----------------------------------------------------------
    printf("\n=== const æŒ‡é’ˆ ===\n");

    int a = 10, b = 20;

    // æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼šä¸èƒ½é€šè¿‡æŒ‡é’ˆä¿®æ”¹å€¼ï¼Œä½†å¯ä»¥æ”¹å˜æŒ‡é’ˆæŒ‡å‘
    const int *cp = &a;
    printf("const int *cp = %d\n", *cp);
    // *cp = 99;  // é”™è¯¯ï¼ä¸èƒ½é€šè¿‡ cp ä¿®æ”¹ a
    cp = &b;     // å¯ä»¥ï¼šæŒ‡é’ˆæœ¬èº«å¯ä»¥æ”¹å˜æŒ‡å‘
    printf("cp æ”¹æŒ‡å‘ b: %d\n", *cp);

    // å¸¸é‡æŒ‡é’ˆï¼šæŒ‡é’ˆæœ¬èº«ä¸èƒ½æ”¹å˜ï¼Œä½†å¯ä»¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å€¼
    int *const cp2 = &a;
    *cp2 = 99;   // å¯ä»¥ï¼šä¿®æ”¹ a çš„å€¼
    // cp2 = &b; // é”™è¯¯ï¼æŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡
    printf("å¸¸é‡æŒ‡é’ˆ *cp2 = %d\n", *cp2);

    // æŒ‡å‘å¸¸é‡çš„å¸¸é‡æŒ‡é’ˆï¼šä¸¤è€…éƒ½ä¸èƒ½æ”¹
    const int *const cp3 = &a;
    printf("åŒ const: %d\n", *cp3);

    // å‡½æ•°å‚æ•°ä¸­å¸¸è§ï¼šconst é˜²æ­¢æ„å¤–ä¿®æ”¹
    // void print_array(const int *arr, int len) { ... }

    // ----------------------------------------------------------
    // 5. void æŒ‡é’ˆï¼ˆé€šç”¨æŒ‡é’ˆï¼‰
    // ----------------------------------------------------------
    printf("\n=== void* æŒ‡é’ˆ ===\n");

    // void* å¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹ï¼Œä½†ä½¿ç”¨å‰å¿…é¡»è½¬æ¢
    int    i_val = 42;
    double d_val = 3.14;
    char   c_val = 'X';

    void *vp;

    vp = &i_val;
    printf("void* æŒ‡å‘ int: %d\n", *(int*)vp);  // å¿…é¡»å¼ºåˆ¶è½¬æ¢

    vp = &d_val;
    printf("void* æŒ‡å‘ double: %.2f\n", *(double*)vp);

    vp = &c_val;
    printf("void* æŒ‡å‘ char: %c\n", *(char*)vp);

    // memcpyã€memset ä½¿ç”¨ void*
    int src[5] = {1, 2, 3, 4, 5};
    int dst[5];
    memcpy(dst, src, sizeof(src));
    printf("memcpy: ");
    for (int i = 0; i < 5; i++) printf("%d ", dst[i]);
    printf("\n");

    // ----------------------------------------------------------
    // 6. å‡½æ•°æŒ‡é’ˆè¯¦è§£
    // ----------------------------------------------------------
    printf("\n=== å‡½æ•°æŒ‡é’ˆ ===\n");

    // å£°æ˜ï¼šè¿”å›ç±»å‹ (*æŒ‡é’ˆå)(å‚æ•°ç±»å‹...)
    int (*fp)(int, int);

    // èµ‹å€¼å¹¶è°ƒç”¨
    int add_func(int a, int b);  // å‰å‘å£°æ˜
    // fp = add_func;
    // printf("fp(3, 4) = %d\n", fp(3, 4));

    // æŒ‡å‘å„ç§å‡½æ•°
    void (*print_fn)(const char *) = printf;  // æŒ‡å‘ printfï¼ˆç®€åŒ–ï¼‰
    // print_fn("æµ‹è¯•å‡½æ•°æŒ‡é’ˆ\n");

    printf("sizeof(int*)   = %zu\n", sizeof(int*));
    printf("sizeof(void*)  = %zu\n", sizeof(void*));
    printf("sizeof(int)    = %zu\n", sizeof(int));

    // ----------------------------------------------------------
    // 7. å¸¸è§æŒ‡é’ˆé”™è¯¯ï¼ˆè­¦ç¤ºï¼‰
    // ----------------------------------------------------------
    printf("\n=== å¸¸è§æŒ‡é’ˆé”™è¯¯ï¼ˆæ¼”ç¤ºï¼Œä¸å®é™…è§¦å‘ï¼‰===\n");
    printf("1. è§£å¼•ç”¨ NULL æŒ‡é’ˆ -> æ®µé”™è¯¯\n");
    printf("2. æ‚¬ç©ºæŒ‡é’ˆï¼ˆDangling Pointerï¼‰ï¼šæŒ‡å‘å·²é‡Šæ”¾çš„å†…å­˜\n");
    printf("3. è¶Šç•Œè®¿é—®ï¼šarr[-1] æˆ– arr[len]\n");
    printf("4. æœªåˆå§‹åŒ–æŒ‡é’ˆï¼ˆé‡æŒ‡é’ˆï¼‰\n");
    printf("5. å†…å­˜æ³„æ¼ï¼šmalloc åå¿˜è®° free\n");

    // æ­£ç¡®åšæ³•ï¼šåˆå§‹åŒ–åæ£€æŸ¥
    int *safe_p = NULL;
    safe_p = (int*)malloc(sizeof(int));
    if (safe_p == NULL) {
        fprintf(stderr, "å†…å­˜åˆ†é…å¤±è´¥\n");
        return 1;
    }
    *safe_p = 42;
    printf("å®‰å…¨åˆ†é…: %d\n", *safe_p);
    free(safe_p);
    safe_p = NULL;  // é‡Šæ”¾åç½® NULLï¼Œé¿å…æ‚¬ç©ºæŒ‡é’ˆ

    printf("\n=== æŒ‡é’ˆæ¼”ç¤ºå®Œæˆ ===\n");
    return 0;
}

int add_func(int a, int b) { return a + b; }
```
