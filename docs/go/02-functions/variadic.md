# variadic.go

::: info æ–‡ä»¶ä¿¡æ¯
- ğŸ“„ åŸæ–‡ä»¶ï¼š`03_variadic.go`
- ğŸ”¤ è¯­è¨€ï¼šgo
:::

## å®Œæ•´ä»£ç 

```go
package main

import (
	"fmt"
	"strings"
)

// ============================================================
//                      å¯å˜å‚æ•°å‡½æ•°
// ============================================================
// å¯å˜å‚æ•°å…è®¸å‡½æ•°æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°
// è¯­æ³•: func å‡½æ•°å(å‚æ•°å ...ç±»å‹)
// åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯å˜å‚æ•°æ˜¯ä¸€ä¸ªåˆ‡ç‰‡

func main03() {
	fmt.Println("\n==================== 03_variadic ====================")
	fmt.Println("=== å¯å˜å‚æ•°åŸºç¡€ ===")

	// ----------------------------------------------------------
	// åŸºæœ¬è°ƒç”¨
	// ----------------------------------------------------------
	// å¯ä»¥ä¼ é€’ä»»æ„æ•°é‡çš„å‚æ•°
	fmt.Println("sum() =", sum())           // 0 ä¸ªå‚æ•°
	fmt.Println("sum(1) =", sum(1))         // 1 ä¸ªå‚æ•°
	fmt.Println("sum(1, 2) =", sum(1, 2))   // 2 ä¸ªå‚æ•°
	fmt.Println("sum(1, 2, 3, 4, 5) =", sum(1, 2, 3, 4, 5))

	// ----------------------------------------------------------
	// ä¼ é€’åˆ‡ç‰‡ï¼ˆå±•å¼€ï¼‰
	// ----------------------------------------------------------
	fmt.Println("\n=== åˆ‡ç‰‡å±•å¼€ ===")

	nums := []int{10, 20, 30, 40}
	// ã€é‡è¦ã€‘ä½¿ç”¨ ... å±•å¼€åˆ‡ç‰‡
	fmt.Println("sum(nums...) =", sum(nums...))

	// ã€æ³¨æ„ã€‘ä¸èƒ½ç›´æ¥ä¼ åˆ‡ç‰‡
	// sum(nums)  // é”™è¯¯ï¼ç±»å‹ä¸åŒ¹é…

	// éƒ¨åˆ†å±•å¼€
	part := []int{100, 200}
	fmt.Println("sum(1, 2, part...) ä¸å…è®¸") // Go ä¸æ”¯æŒè¿™ç§æ··åˆ

	// ä½†å¯ä»¥å…ˆæ„å»ºåˆ‡ç‰‡å†å±•å¼€
	all := append([]int{1, 2}, part...)
	fmt.Println("æ„å»ºåå±•å¼€:", sum(all...))

	// ----------------------------------------------------------
	// å¯å˜å‚æ•° + å›ºå®šå‚æ•°
	// ----------------------------------------------------------
	fmt.Println("\n=== å¯å˜å‚æ•° + å›ºå®šå‚æ•° ===")

	// ã€è§„åˆ™ã€‘å¯å˜å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°
	greetAll("ä½ å¥½", "å¼ ä¸‰", "æå››", "ç‹äº”")
	greetAll("Hello", "Alice", "Bob")

	// ----------------------------------------------------------
	// ç©ºæ¥å£å¯å˜å‚æ•°
	// ----------------------------------------------------------
	fmt.Println("\n=== ä»»æ„ç±»å‹å¯å˜å‚æ•° ===")

	// ä½¿ç”¨ ...anyï¼ˆç­‰ä»·äº ...interface{}ï¼‰æ¥å—ä»»æ„ç±»å‹
	printAll("å­—ç¬¦ä¸²", 42, 3.14, true, []int{1, 2, 3})

	// ã€æç¤ºã€‘fmt.Println å°±æ˜¯è¿™æ ·å®ç°çš„
	// func Println(a ...any) (n int, err error)

	// ----------------------------------------------------------
	// å¯å˜å‚æ•°çš„å†…éƒ¨å®ç°
	// ----------------------------------------------------------
	fmt.Println("\n=== å¯å˜å‚æ•°å†…éƒ¨åŸç† ===")

	// å¯å˜å‚æ•°åœ¨å‡½æ•°å†…éƒ¨æ˜¯åˆ‡ç‰‡
	inspectVariadic(1, 2, 3)
	inspectVariadic() // ç©ºåˆ‡ç‰‡ï¼Œä¸æ˜¯ nil

	// ----------------------------------------------------------
	// å®é™…åº”ç”¨ï¼šå­—ç¬¦ä¸²è¿æ¥
	// ----------------------------------------------------------
	fmt.Println("\n=== å®é™…åº”ç”¨ ===")

	result := join("-", "2024", "01", "15")
	fmt.Println("æ—¥æœŸ:", result)

	result = join("/", "usr", "local", "bin")
	fmt.Println("è·¯å¾„:", result)

	// ----------------------------------------------------------
	// å®é™…åº”ç”¨ï¼šé…ç½®é€‰é¡¹æ¨¡å¼
	// ----------------------------------------------------------
	fmt.Println("\n=== é€‰é¡¹æ¨¡å¼ ===")

	// ä½¿ç”¨å¯å˜å‚æ•°å®ç°å¯é€‰é…ç½®
	s1 := NewServer("localhost", 8080)
	fmt.Printf("æœåŠ¡å™¨1: %+v\n", s1)

	s2 := NewServer("0.0.0.0", 80,
		WithTimeout(30),
		WithMaxConns(1000),
	)
	fmt.Printf("æœåŠ¡å™¨2: %+v\n", s2)

	// ----------------------------------------------------------
	// å¯å˜å‚æ•°ä¼ é€’
	// ----------------------------------------------------------
	fmt.Println("\n=== å¯å˜å‚æ•°ä¼ é€’ ===")

	wrapper(1, 2, 3, 4, 5)
}

// ============================================================
//                      å¯å˜å‚æ•°å‡½æ•°å®šä¹‰
// ============================================================

// ----------------------------------------------------------
// åŸºæœ¬å¯å˜å‚æ•°
// ----------------------------------------------------------
// è¯­æ³•: func å‡½æ•°å(å‚æ•°å ...ç±»å‹)
// ã€å†…éƒ¨ã€‘nums æ˜¯ []int ç±»å‹çš„åˆ‡ç‰‡
func sum(nums ...int) int {
	total := 0
	for _, n := range nums {
		total += n
	}
	return total
}

// ----------------------------------------------------------
// å›ºå®šå‚æ•° + å¯å˜å‚æ•°
// ----------------------------------------------------------
// ã€è§„åˆ™ã€‘å¯å˜å‚æ•°å¿…é¡»æ”¾åœ¨æœ€å
// ã€è§„åˆ™ã€‘åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å‚æ•°
func greetAll(greeting string, names ...string) {
	for _, name := range names {
		fmt.Println(greeting + ",", name)
	}
}

// ----------------------------------------------------------
// ä»»æ„ç±»å‹å¯å˜å‚æ•°
// ----------------------------------------------------------
// any æ˜¯ interface{} çš„åˆ«åï¼ˆGo 1.18+ï¼‰
// å¯ä»¥æ¥å—ä»»æ„ç±»å‹çš„å‚æ•°
func printAll(args ...any) {
	for i, arg := range args {
		fmt.Printf("  å‚æ•°%d: %v (ç±»å‹: %T)\n", i, arg, arg)
	}
}

// ----------------------------------------------------------
// æŸ¥çœ‹å¯å˜å‚æ•°å†…éƒ¨
// ----------------------------------------------------------
func inspectVariadic(nums ...int) {
	fmt.Printf("  ç±»å‹: %T\n", nums)
	fmt.Printf("  é•¿åº¦: %d\n", len(nums))
	fmt.Printf("  å®¹é‡: %d\n", cap(nums))
	fmt.Printf("  nil?: %t\n", nums == nil)
	fmt.Printf("  å€¼: %v\n", nums)
}

// ----------------------------------------------------------
// å­—ç¬¦ä¸²è¿æ¥
// ----------------------------------------------------------
func join(sep string, parts ...string) string {
	return strings.Join(parts, sep)
}

// ----------------------------------------------------------
// é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Options Patternï¼‰
// ----------------------------------------------------------
// ã€ç”¨é€”ã€‘çµæ´»é…ç½®ï¼Œé¿å…é•¿å‚æ•°åˆ—è¡¨
// ã€ä¼˜ç‚¹ã€‘
// - å‘åå…¼å®¹ï¼ˆæ·»åŠ æ–°é€‰é¡¹ä¸å½±å“æ—§ä»£ç ï¼‰
// - å¯è¯»æ€§å¥½
// - æä¾›é»˜è®¤å€¼

// æœåŠ¡å™¨é…ç½®
type Server struct {
	Host     string
	Port     int
	Timeout  int
	MaxConns int
}

// é€‰é¡¹å‡½æ•°ç±»å‹
type ServerOption func(*Server)

// é€‰é¡¹å‡½æ•°
func WithTimeout(t int) ServerOption {
	return func(s *Server) {
		s.Timeout = t
	}
}

func WithMaxConns(n int) ServerOption {
	return func(s *Server) {
		s.MaxConns = n
	}
}

// æ„é€ å‡½æ•°
func NewServer(host string, port int, opts ...ServerOption) *Server {
	// 1. è®¾ç½®é»˜è®¤å€¼
	s := &Server{
		Host:     host,
		Port:     port,
		Timeout:  10,      // é»˜è®¤è¶…æ—¶
		MaxConns: 100,     // é»˜è®¤æœ€å¤§è¿æ¥æ•°
	}

	// 2. åº”ç”¨é€‰é¡¹
	for _, opt := range opts {
		opt(s)
	}

	return s
}

// ----------------------------------------------------------
// å¯å˜å‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°
// ----------------------------------------------------------
// ã€é‡è¦ã€‘ä¼ é€’æ—¶éœ€è¦ä½¿ç”¨ ... å±•å¼€
func wrapper(nums ...int) {
	fmt.Println("wrapper æ”¶åˆ°:", nums)
	// ä¼ é€’ç»™å¦ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°
	fmt.Println("è°ƒç”¨ sum:", sum(nums...))
}

// ============================================================
//                      é‡è¦æ³¨æ„äº‹é¡¹
// ============================================================
//
// 1. ã€å¯å˜å‚æ•°ä½ç½®ã€‘å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°
//    func foo(a int, b ...int) {}  // æ­£ç¡®
//    func foo(a ...int, b int) {}  // é”™è¯¯
//
// 2. ã€å¯å˜å‚æ•°æ•°é‡ã€‘åªèƒ½æœ‰ä¸€ä¸ª
//    func foo(a ...int, b ...string) {}  // é”™è¯¯
//
// 3. ã€åˆ‡ç‰‡ä¼ é€’ã€‘å¿…é¡»ä½¿ç”¨ ... å±•å¼€
//    nums := []int{1, 2, 3}
//    sum(nums...)  // æ­£ç¡®
//    sum(nums)     // é”™è¯¯
//
// 4. ã€ç©ºè°ƒç”¨ã€‘å¯å˜å‚æ•°å¯ä»¥ä¸ä¼ 
//    sum()  // åˆæ³•ï¼Œnums æ˜¯ç©ºåˆ‡ç‰‡ []int{}
//
// 5. ã€nil vs ç©ºåˆ‡ç‰‡ã€‘
//    ä¸ä¼ å‚æ•°æ—¶ï¼Œå¯å˜å‚æ•°æ˜¯ç©ºåˆ‡ç‰‡ï¼Œä¸æ˜¯ nil
//    len == 0, cap == 0, != nil
//
// 6. ã€æ€§èƒ½ã€‘æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºæ–°åˆ‡ç‰‡
//    é«˜é¢‘è°ƒç”¨æ—¶éœ€æ³¨æ„æ€§èƒ½
//
// 7. ã€ç±»å‹å®‰å…¨ã€‘
//    ä½¿ç”¨ ...any ä¼šå¤±å»ç±»å‹å®‰å…¨
//    å°½é‡ä½¿ç”¨å…·ä½“ç±»å‹
```
