# struct basics.go

::: info æ–‡ä»¶ä¿¡æ¯
- ğŸ“„ åŸæ–‡ä»¶ï¼š`01_struct_basics.go`
- ğŸ”¤ è¯­è¨€ï¼šgo
:::

## å®Œæ•´ä»£ç 

```go
package main

import (
	"encoding/json"
	"fmt"
)

// ============================================================
//                      ç»“æ„ä½“åŸºç¡€
// ============================================================
// ç»“æ„ä½“æ˜¯ Go ä¸­æœ€é‡è¦çš„å¤åˆç±»å‹
// ç”¨äºå°†å¤šä¸ªç›¸å…³çš„æ•°æ®ç»„ç»‡åœ¨ä¸€èµ·
// Go æ²¡æœ‰ç±»ï¼ˆclassï¼‰ï¼Œä½¿ç”¨ç»“æ„ä½“ + æ–¹æ³•å®ç°é¢å‘å¯¹è±¡

func main() {
	fmt.Println("=== ç»“æ„ä½“åŸºç¡€ ===")

	// ----------------------------------------------------------
	// åˆ›å»ºç»“æ„ä½“å®ä¾‹
	// ----------------------------------------------------------

	// æ–¹å¼1: å­—æ®µåèµ‹å€¼ï¼ˆæ¨èï¼Œé¡ºåºæ— å…³ï¼‰
	p1 := Person{
		Name: "å¼ ä¸‰",
		Age:  25,
		City: "åŒ—äº¬",
	}
	fmt.Printf("å­—æ®µåèµ‹å€¼: %+v\n", p1)

	// æ–¹å¼2: æŒ‰é¡ºåºèµ‹å€¼ï¼ˆä¸æ¨èï¼Œé¡ºåºæ•æ„Ÿï¼‰
	p2 := Person{"æå››", 30, "ä¸Šæµ·"}
	fmt.Printf("é¡ºåºèµ‹å€¼: %+v\n", p2)

	// æ–¹å¼3: é›¶å€¼åˆå§‹åŒ–
	var p3 Person
	fmt.Printf("é›¶å€¼: %+v\n", p3) // æ‰€æœ‰å­—æ®µä¸ºé›¶å€¼

	// æ–¹å¼4: éƒ¨åˆ†å­—æ®µèµ‹å€¼ï¼ˆå…¶ä½™ä¸ºé›¶å€¼ï¼‰
	p4 := Person{Name: "ç‹äº”"}
	fmt.Printf("éƒ¨åˆ†èµ‹å€¼: %+v\n", p4)

	// æ–¹å¼5: new å‡½æ•°ï¼ˆè¿”å›æŒ‡é’ˆï¼‰
	p5 := new(Person)
	p5.Name = "èµµå…­"
	p5.Age = 35
	fmt.Printf("new åˆ›å»º: %+v\n", *p5)

	// ----------------------------------------------------------
	// è®¿é—®å’Œä¿®æ”¹å­—æ®µ
	// ----------------------------------------------------------
	fmt.Println("\n=== è®¿é—®å’Œä¿®æ”¹å­—æ®µ ===")

	fmt.Println("å§“å:", p1.Name)
	fmt.Println("å¹´é¾„:", p1.Age)

	p1.Age = 26 // ä¿®æ”¹å­—æ®µ
	fmt.Println("ä¿®æ”¹åå¹´é¾„:", p1.Age)

	// ----------------------------------------------------------
	// ç»“æ„ä½“æŒ‡é’ˆ
	// ----------------------------------------------------------
	fmt.Println("\n=== ç»“æ„ä½“æŒ‡é’ˆ ===")

	pp := &Person{Name: "é’±ä¸ƒ", Age: 40, City: "å¹¿å·"}

	// ã€é‡è¦ã€‘Go è‡ªåŠ¨è§£å¼•ç”¨ï¼Œä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰ä»·
	fmt.Println("æŒ‡é’ˆè®¿é—®:", pp.Name)   // è¯­æ³•ç³–
	fmt.Println("æ˜¾å¼è§£å¼•ç”¨:", (*pp).Name) // å®Œæ•´å†™æ³•

	// ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å€¼
	pp.Age = 41
	fmt.Printf("ä¿®æ”¹å: %+v\n", *pp)

	// ----------------------------------------------------------
	// ç»“æ„ä½“æ¯”è¾ƒ
	// ----------------------------------------------------------
	fmt.Println("\n=== ç»“æ„ä½“æ¯”è¾ƒ ===")

	a := Person{Name: "Test", Age: 20, City: "Test"}
	b := Person{Name: "Test", Age: 20, City: "Test"}
	c := Person{Name: "Test", Age: 21, City: "Test"}

	fmt.Println("a == b:", a == b) // true
	fmt.Println("a == c:", a == c) // false

	// ã€æ³¨æ„ã€‘åŒ…å«åˆ‡ç‰‡ã€mapã€å‡½æ•°çš„ç»“æ„ä½“ä¸èƒ½ç›´æ¥æ¯”è¾ƒ

	// ----------------------------------------------------------
	// åŒ¿åç»“æ„ä½“
	// ----------------------------------------------------------
	fmt.Println("\n=== åŒ¿åç»“æ„ä½“ ===")

	// ä¸´æ—¶ä½¿ç”¨ï¼Œæ— éœ€å®šä¹‰ç±»å‹
	point := struct {
		X, Y int
	}{10, 20}

	fmt.Printf("åŒ¿åç»“æ„ä½“: %+v\n", point)

	// å¸¸ç”¨äºæµ‹è¯•æ•°æ®
	testCases := []struct {
		input    int
		expected int
	}{
		{1, 2},
		{2, 4},
		{3, 6},
	}
	fmt.Println("æµ‹è¯•ç”¨ä¾‹:", testCases)

	// ----------------------------------------------------------
	// ç»“æ„ä½“åµŒå…¥ï¼ˆç»„åˆï¼‰
	// ----------------------------------------------------------
	fmt.Println("\n=== ç»“æ„ä½“åµŒå…¥ ===")

	emp := Employee{
		Person:   Person{Name: "å­™å…«", Age: 28, City: "æ·±åœ³"},
		Title:    "å·¥ç¨‹å¸ˆ",
		Salary:   15000,
		Department: "æŠ€æœ¯éƒ¨",
	}

	// ç›´æ¥è®¿é—®åµŒå…¥å­—æ®µï¼ˆå­—æ®µæå‡ï¼‰
	fmt.Println("å§“å:", emp.Name)     // ç­‰ä»·äº emp.Person.Name
	fmt.Println("èŒä½:", emp.Title)
	fmt.Printf("å®Œæ•´ä¿¡æ¯: %+v\n", emp)

	// ----------------------------------------------------------
	// ç»“æ„ä½“æ ‡ç­¾ï¼ˆTagsï¼‰
	// ----------------------------------------------------------
	fmt.Println("\n=== ç»“æ„ä½“æ ‡ç­¾ ===")

	user := User{
		ID:       1,
		Username: "johndoe",
		Email:    "john@example.com",
		Password: "secret123",
	}

	// JSON åºåˆ—åŒ–
	jsonData, _ := json.Marshal(user)
	fmt.Println("JSON:", string(jsonData))
	// æ³¨æ„: password å­—æ®µè¢« json:"-" æ’é™¤

	// JSON ååºåˆ—åŒ–
	jsonStr := `{"id":2,"username":"janedoe","email":"jane@example.com"}`
	var user2 User
	json.Unmarshal([]byte(jsonStr), &user2)
	fmt.Printf("ååºåˆ—åŒ–: %+v\n", user2)

	// ----------------------------------------------------------
	// ç»“æ„ä½“æ–¹æ³•
	// ----------------------------------------------------------
	fmt.Println("\n=== ç»“æ„ä½“æ–¹æ³• ===")

	rect := Rectangle{Width: 10, Height: 5}
	fmt.Println("é¢ç§¯:", rect.Area())
	fmt.Println("å‘¨é•¿:", rect.Perimeter())
	fmt.Println("ä¿¡æ¯:", rect.String())

	// æŒ‡é’ˆæ–¹æ³•
	rect.Scale(2)
	fmt.Println("ç¼©æ”¾å:", rect.String())

	// ----------------------------------------------------------
	// æ„é€ å‡½æ•°æ¨¡å¼
	// ----------------------------------------------------------
	fmt.Println("\n=== æ„é€ å‡½æ•°æ¨¡å¼ ===")

	// Go æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä½¿ç”¨å·¥å‚å‡½æ•°ä»£æ›¿
	config := NewConfig("localhost", 8080)
	fmt.Printf("é»˜è®¤é…ç½®: %+v\n", config)

	config2 := NewConfigWithOptions("0.0.0.0", 80, true, 30)
	fmt.Printf("è‡ªå®šä¹‰é…ç½®: %+v\n", config2)

	main02()
	main03()
}

// ============================================================
//                      ç»“æ„ä½“å®šä¹‰
// ============================================================

// ----------------------------------------------------------
// åŸºæœ¬ç»“æ„ä½“
// ----------------------------------------------------------
// è¯­æ³•: type ç»“æ„ä½“å struct { å­—æ®µå ç±»å‹ }
// ã€å‘½åè§„åˆ™ã€‘
// - å¤§å†™å¼€å¤´ï¼šå¯å¯¼å‡ºï¼ˆpublicï¼‰
// - å°å†™å¼€å¤´ï¼šåŒ…å†…ç§æœ‰ï¼ˆprivateï¼‰

// Person äººå‘˜ç»“æ„ä½“
type Person struct {
	Name string // å¯å¯¼å‡ºå­—æ®µ
	Age  int
	City string
}

// ----------------------------------------------------------
// åµŒå…¥ç»“æ„ä½“ï¼ˆç»„åˆï¼‰
// ----------------------------------------------------------
// Go æ¨å´‡ç»„åˆè€Œéç»§æ‰¿
// åµŒå…¥çš„å­—æ®µå’Œæ–¹æ³•ä¼šè¢«æå‡åˆ°å¤–å±‚

// Employee å‘˜å·¥ç»“æ„ä½“
type Employee struct {
	Person           // åµŒå…¥ Personï¼ˆåŒ¿åå­—æ®µï¼‰
	Title      string
	Salary     float64
	Department string
}

// ----------------------------------------------------------
// å¸¦æ ‡ç­¾çš„ç»“æ„ä½“
// ----------------------------------------------------------
// æ ‡ç­¾æ˜¯å­—ç¬¦ä¸²ï¼Œç”¨åå¼•å·åŒ…è£¹
// å¸¸ç”¨äº JSONã€æ•°æ®åº“æ˜ å°„ã€éªŒè¯ç­‰

// User ç”¨æˆ·ç»“æ„ä½“ï¼ˆå¸¦æ ‡ç­¾ï¼‰
type User struct {
	ID       int    `json:"id"`
	Username string `json:"username"`
	Email    string `json:"email"`
	Password string `json:"-"` // - è¡¨ç¤º JSON åºåˆ—åŒ–æ—¶å¿½ç•¥
}

// ----------------------------------------------------------
// å¸¦æ–¹æ³•çš„ç»“æ„ä½“
// ----------------------------------------------------------

// Rectangle çŸ©å½¢
type Rectangle struct {
	Width  float64
	Height float64
}

// Area è®¡ç®—é¢ç§¯ï¼ˆå€¼æ¥æ”¶è€…ï¼‰
func (r Rectangle) Area() float64 {
	return r.Width * r.Height
}

// Perimeter è®¡ç®—å‘¨é•¿
func (r Rectangle) Perimeter() float64 {
	return 2 * (r.Width + r.Height)
}

// String å­—ç¬¦ä¸²è¡¨ç¤º
func (r Rectangle) String() string {
	return fmt.Sprintf("Rectangle{%.1f x %.1f}", r.Width, r.Height)
}

// Scale ç¼©æ”¾ï¼ˆæŒ‡é’ˆæ¥æ”¶è€…ï¼Œä¿®æ”¹åŸå€¼ï¼‰
func (r *Rectangle) Scale(factor float64) {
	r.Width *= factor
	r.Height *= factor
}

// ----------------------------------------------------------
// æ„é€ å‡½æ•°ï¼ˆå·¥å‚å‡½æ•°ï¼‰
// ----------------------------------------------------------
// ã€æƒ¯ä¾‹ã€‘å‡½æ•°åä¸º New + ç±»å‹å
// ã€æƒ¯ä¾‹ã€‘è¿”å›æŒ‡é’ˆï¼ˆå¤§å‹ç»“æ„ä½“ï¼‰æˆ–å€¼ï¼ˆå°å‹ç»“æ„ä½“ï¼‰

// Config é…ç½®ç»“æ„ä½“
type Config struct {
	Host    string
	Port    int
	Debug   bool
	Timeout int
}

// NewConfig åˆ›å»ºé»˜è®¤é…ç½®
func NewConfig(host string, port int) *Config {
	return &Config{
		Host:    host,
		Port:    port,
		Debug:   false,  // é»˜è®¤å€¼
		Timeout: 10,     // é»˜è®¤å€¼
	}
}

// NewConfigWithOptions åˆ›å»ºè‡ªå®šä¹‰é…ç½®
func NewConfigWithOptions(host string, port int, debug bool, timeout int) *Config {
	return &Config{
		Host:    host,
		Port:    port,
		Debug:   debug,
		Timeout: timeout,
	}
}

// ============================================================
//                      é‡è¦æ³¨æ„äº‹é¡¹
// ============================================================
//
// 1. ã€å­—æ®µå‘½åã€‘
//    - å¤§å†™å¼€å¤´ï¼šå¯å¯¼å‡ºï¼ˆå…¶ä»–åŒ…å¯è®¿é—®ï¼‰
//    - å°å†™å¼€å¤´ï¼šåŒ…å†…ç§æœ‰
//
// 2. ã€é›¶å€¼ã€‘
//    ç»“æ„ä½“çš„é›¶å€¼æ˜¯æ‰€æœ‰å­—æ®µçš„é›¶å€¼
//    æ•°å€¼=0, å­—ç¬¦ä¸²="", å¸ƒå°”=false, æŒ‡é’ˆ/åˆ‡ç‰‡/map=nil
//
// 3. ã€å€¼ vs æŒ‡é’ˆã€‘
//    - å°ç»“æ„ä½“ï¼ˆå‡ ä¸ªå­—æ®µï¼‰ï¼šä¼ å€¼
//    - å¤§ç»“æ„ä½“æˆ–éœ€è¦ä¿®æ”¹ï¼šä¼ æŒ‡é’ˆ
//    - æ–¹æ³•éœ€è¦ä¿®æ”¹æ¥æ”¶è€…ï¼šæŒ‡é’ˆæ¥æ”¶è€…
//
// 4. ã€åµŒå…¥ vs å­—æ®µã€‘
//    åµŒå…¥ï¼šPersonï¼ˆåŒ¿åï¼Œå­—æ®µæå‡ï¼‰
//    å­—æ®µï¼šperson Personï¼ˆå‘½åï¼Œéœ€è¦é€šè¿‡å­—æ®µè®¿é—®ï¼‰
//
// 5. ã€ç»“æ„ä½“æ¯”è¾ƒã€‘
//    - æ‰€æœ‰å­—æ®µå¯æ¯”è¾ƒ â†’ ç»“æ„ä½“å¯æ¯”è¾ƒ
//    - åŒ…å«åˆ‡ç‰‡/map/å‡½æ•° â†’ ä¸å¯ç›´æ¥æ¯”è¾ƒ
//
// 6. ã€æ ‡ç­¾ä½¿ç”¨ã€‘
//    - json: JSON åºåˆ—åŒ–
//    - db: æ•°æ®åº“æ˜ å°„
//    - validate: éªŒè¯è§„åˆ™
//    - å¯é€šè¿‡ reflect åŒ…è¯»å–
```
